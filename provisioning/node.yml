- name: Create tmp directory
  file: path={{ tmp_dir }} state=directory
- name: Fetch nodejs setup
  get_url:
    url: "https://deb.nodesource.com/setup_6.x"
    dest: "{{ tmp_dir }}/setup_6.x"
  register: downloaded_nodejs_setup
- name: Install nodejs setup
  shell: "sh {{ tmp_dir }}/setup_6.x || rm {{ tmp_dir }}/setup_6.x"
  when: downloaded_nodejs_setup is changed
- name: Install nodejs
  action: "{{ ansible_pkg_mgr }} name={{ item }}"
  with_items:
    - nodejs
    - g++
    - make
- name: Install n
  npm:
    name: n
    global: yes
- name: Use node v10
  shell: "n 10"
  changed_when: False
- name: Install global npm packages
  npm:
    name: "{{ item }}"
    global: yes
  with_items:
    - yarn
    - pm2